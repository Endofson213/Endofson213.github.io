<!DOCTYPE html>
<html lang="en">
   <!--Bootstrap/JSFile/Fonts/CSS--> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="loggedIn.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script type="module" defer src="app.js"></script>
</head>
<body>

    <!--Header SECTION CODE-->  
    <header>
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <img src="Logo.png" width="150" class="img-fluid">
                    <!-- Text beside the logo -->
                    <div class="text-container ms-3" id="text">
                        <p class="doletext mb-0">DOLE XI</p>
                        <h1 class="mb-0">Government Internship Program</h1>
                    </div>
                </div>
    
                <!-- Navbar -->
                <nav class="navbar navbar-expand-lg navbar-light">
                    <div class="container-fluid">
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false"
                            aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse justify-content-end" id="navbarNavDropdown">
                            <ul class="navbar-nav">
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle mx-2" href="#" role="button"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                        User Manual
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item"
                                                href="https://drive.google.com/file/d/18B77oCpC5Hz092WRtYaT2kbcN6YiShdh/view">GIP
                                                Applicant</a></li>
                                        <li><a class="dropdown-item"
                                                href="https://drive.google.com/file/d/1ZsZwgUP23EvQ7s2-KRcJDluAFIIOR_33/view">Partner
                                                Agency</a></li>
                                    </ul>
                                </li>
                                <li class="nav-item">
                                    <button type="button" class="btn btn-success" id="logoutBtn">Logout</button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>
    
    <!-- Background and Profile Display -->
    <div class="background">
        <div class="overlay"></div>
        <div class="content">
            <section class="login-section">
                <section class="bg-light">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12 mb-4 mb-sm-5">
                                <div class="card card-style1 border-0">
                                    <div class="card-body p-1-9 p-sm-2-3 p-md-6 p-lg-7">
                                        <div class="row align-items-center">
                                            <div class="col-lg-6 mb-4 mb-lg-0">
                                                <img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="User Avatar" id="user-avatar">
                                            </div>
                                            <div class="col-lg-6 px-xl-10">
                                                <div class="bg-secondary d-lg-inline-block py-1-9 px-1-9 px-sm-6 mb-1-9 rounded">
                                                    <h3 class="h2 text-white mb-0" id="user-name">User Full Name</h3>
                                                    <span class="text-primary" id="user-role">User Role</span>
                                                </div>
                                                <ul class="list-unstyled mb-1-9">
                                                    <li class="mb-2 mb-xl-3 display-28">
                                                        <span class="display-26 text-secondary me-2 font-weight-600">Email:</span>
                                                        <span id="user-email">User Email</span>
                                                    </li>
                                                    <li class="display-28">
                                                        <span class="display-26 text-secondary me-2 font-weight-600">Account Created:</span>
                                                        <span id="account-created">Account Creation Date</span>
                                                    </li>
                                                </ul>
                                                <!-- Added Edit Details button here -->
                                                <button id="editDetailsBtn" class="btn btn-primary">Edit Details</button>
                                                <ul class="social-icon-style1 list-unstyled mb-0 ps-0">
                                                    <li><a href="#!"><i class="ti-twitter-alt"></i></a></li>
                                                    <li><a href="#!"><i class="ti-facebook"></i></a></li>
                                                    <li><a href="#!"><i class="ti-pinterest"></i></a></li>
                                                    <li><a href="#!"><i class="ti-instagram"></i></a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>   
                        </div>
                    </div>
                </section>  
            </section>
        </div>
    </div>

    <!-- Footer Section -->
    <footer>
        <div class="footercontainer">
            <!-- Footer content omitted for brevity -->
        </div>
    </footer>

    <!-- Firebase and Google Sign-In -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB16sNysLRzhQjww9it86rXEXpTKjiXuHE",
            authDomain: "authentication-3f79b.firebaseapp.com",
            databaseURL: "https://authentication-3f79b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "authentication-3f79b",
            storageBucket: "authentication-3f79b.appspot.com",
            messagingSenderId: "1017764485191",
            appId: "1:1017764485191:web:9e7bce8654b02313bcb962"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Function to update user data in Firestore and update profile display
        async function updateUserProfile(user) {
            const userRef = doc(db, "users", user.uid);
            const userDoc = await getDoc(userRef);
            
            // If user document exists, update UI with Firestore data
            if (userDoc.exists()) {
                const userData = userDoc.data();
                document.getElementById("user-name").textContent = userData.fullName || user.displayName;
                document.getElementById("user-role").textContent = userData.accountType || "User";
                document.getElementById("user-email").textContent = user.email;
                document.getElementById("account-created").textContent = user.metadata.creationTime;
            } else {
                // No user document, set default Google data
                document.getElementById("user-name").textContent = user.displayName || "Google User";
                document.getElementById("user-email").textContent = user.email;
                document.getElementById("account-created").textContent = user.metadata.creationTime;

                // Save Google user data to Firestore
                await setDoc(userRef, {
                    fullName: user.displayName || "Google User",
                    accountType: "User",
                    email: user.email,
                    uid: user.uid,
                    creationTime: user.metadata.creationTime
                });
            }
        }

        // Monitor authentication state
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Update user profile
                updateUserProfile(user);
            } else {
                // Redirect to login if user is not signed in
                window.location.href = 'login.html';
            }
        });

        // Edit Details button functionality
        document.getElementById('editDetailsBtn').addEventListener('click', () => {
            window.location.href = 'editDetails.html';
        });

        // Logout function
        document.getElementById('logoutBtn').addEventListener('click', function() {
            signOut(auth).then(() => {
                // Sign-out successful, redirect to home page
                window.location.href = 'index.html';
            }).catch((error) => {
                console.error("Logout error:", error);
            });
        });
    </script>
</body>
</html>